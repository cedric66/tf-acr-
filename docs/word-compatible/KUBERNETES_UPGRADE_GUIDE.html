<!DOCTYPE html>
<html><head><meta charset="UTF-8">
<style>
body { font-family: "Calibri", "Arial", sans-serif; font-size: 11pt; line-height: 1.5; color: #000; max-width: 800px; margin: 20px auto; }
h1 { font-size: 24pt; color: #2E74B5; border-bottom: 2px solid #2E74B5; padding-bottom: 10px; margin-top: 24pt; }
h2 { font-size: 18pt; color: #2E74B5; margin-top: 18pt; }
h3 { font-size: 14pt; color: #1F4D78; margin-top: 14pt; }
h4 { font-size: 12pt; font-weight: bold; margin-top: 12pt; }
p { margin-bottom: 10pt; }
ul, ol { margin-bottom: 10pt; }
li { margin-bottom: 4pt; }
pre { font-family: "Consolas", "Courier New", monospace; font-size: 10pt; background-color: #f5f5f5; padding: 10px; border: 1px solid #ddd; white-space: pre-wrap; word-wrap: break-word; }
code { font-family: "Consolas", "Courier New", monospace; color: #c7254e; background-color: #f9f2f4; padding: 2px 4px; border-radius: 4px; }
pre code { background-color: transparent; color: inherit; padding: 0; }
.mermaid { border: 1px solid #007acc; background-color: #e6f7ff; padding: 15px; border-radius: 5px; margin: 10px 0; }
.mermaid-title { color: #007acc; font-weight: bold; font-family: sans-serif; margin-bottom: 5px; }
table { border-collapse: collapse; width: 100%; margin-bottom: 15px; }
th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
th { background-color: #f2f2f2; color: #333; }
blockquote { border-left: 4px solid #ddd; padding-left: 15px; color: #666; font-style: italic; }
</style>
</head><body>
<h1>Kubernetes 1.28 → 1.29+ Upgrade Guide for AKS</h1>
<p>This document outlines the upgrade path from Kubernetes 1.28 to 1.29+ for our AKS Spot-optimized clusters.</p>
<h2>Overview</h2>
<table>
<tr><td>Version</td><td>Status</td><td>AKS Support End Date</td><td>Action Required</td></tr>
<tr><td>1.28</td><td>Current</td><td>March 2025</td><td>Upgrade to 1.29 by Feb 2025</td></tr>
<tr><td>1.29</td><td>Recommended</td><td>June 2025</td><td>Target version</td></tr>
<tr><td>1.30</td><td>Latest</td><td>TBD</td><td>Future target</td></tr>
<h2>Breaking Changes in 1.29</h2>
<h3>1. API Deprecations</h3>
<table>
<tr><td>Deprecated API</td><td>Replacement</td><td>Impact on This Project</td></tr>
<tr><td><code>flowcontrol.apiserver.k8s.io/v1beta2</code></td><td><code>v1beta3</code></td><td>None (not used)</td></tr>
<tr><td><code>autoscaling/v2beta2</code></td><td><code>autoscaling/v2</code></td><td>Check HPA manifests</td></tr>
</table>
<p><b>Action:</b> Review any HPA configurations in your workloads.</p>
<h3>2. Feature Gate Changes</h3>
<table>
<tr><td>Feature</td><td>Status in 1.29</td><td>Notes</td></tr>
<tr><td><code>PodDisruptionConditions</code></td><td>GA</td><td>PDBs now set pod conditions</td></tr>
<tr><td><code>NodeOutOfServiceVolumeDetach</code></td><td>GA</td><td>Faster volume detachment</td></tr>
</table>
<p><b>Impact:</b> Both features are beneficial for Spot node management - no action required.</p>
<h3>3. Cluster Autoscaler Compatibility</h3>
<table>
<tr><td>K8s Version</td><td>CA Version Required</td></tr>
<tr><td>1.28.x</td><td>1.28.x</td></tr>
<tr><td>1.29.x</td><td>1.29.x</td></tr>
</table>
<p><b>Action:</b> AKS manages the autoscaler version automatically. No manual update needed.</p>
<h2>Pre-Upgrade Checklist</h2>
<h3>1. Validate Current State</h3>
<pre class="bash"><code>
# Check current version

az aks show -g rg-aks-prod -n aks-prod --query kubernetesVersion



# Get available upgrade versions

az aks get-upgrades -g rg-aks-prod -n aks-prod --output table



# Check for deprecated API usage

kubectl get --raw /metrics | grep apiserver_requested_deprecated_apis

</code></pre>
<h3>2. Review Terraform Configuration</h3>
<p>Update <code>kubernetes_version</code> in <code>terraform/environments/prod/main.tf</code>:</p>
<pre class="hcl"><code>
# Before

kubernetes_version = &quot;1.28&quot;



# After

kubernetes_version = &quot;1.29&quot;

</code></pre>
<h3>3. Backup Critical Resources</h3>
<pre class="bash"><code>
# Export all deployments and statefulsets

kubectl get deployments -A -o yaml &gt; deployments-backup.yaml

kubectl get statefulsets -A -o yaml &gt; statefulsets-backup.yaml

kubectl get pdb -A -o yaml &gt; pdb-backup.yaml

</code></pre>
<h2>Upgrade Procedure</h2>
<h3>Option 1: Terraform (Recommended)</h3>
<ol>
<li><b>Update the version in Terraform:</b></li>
<pre class="hcl"><code>
   kubernetes_version = &quot;1.29&quot;

</code></pre>
</ol>
<ol>
<li><b>Plan the change:</b></li>
<pre class="bash"><code>
   terraform plan -target=module.aks

</code></pre>
</ol>
<ol>
<li><b>Apply during maintenance window:</b></li>
<pre class="bash"><code>
   terraform apply -target=module.aks

</code></pre>
</ol>
<h3>Option 2: Azure CLI (Manual)</h3>
<pre class="bash"><code>
# Upgrade control plane first

az aks upgrade \

  --resource-group rg-aks-prod \

  --name aks-prod \

  --kubernetes-version 1.29.0 \

  --control-plane-only



# Then upgrade node pools one at a time

az aks nodepool upgrade \

  --resource-group rg-aks-prod \

  --cluster-name aks-prod \

  --name system \

  --kubernetes-version 1.29.0



az aks nodepool upgrade \

  --resource-group rg-aks-prod \

  --cluster-name aks-prod \

  --name stdworkload \

  --kubernetes-version 1.29.0



# Spot pools (can be done in parallel)

az aks nodepool upgrade \

  --resource-group rg-aks-prod \

  --cluster-name aks-prod \

  --name spotgen1 \

  --kubernetes-version 1.29.0 &amp;



az aks nodepool upgrade \

  --resource-group rg-aks-prod \

  --cluster-name aks-prod \

  --name spotgen2 \

  --kubernetes-version 1.29.0 &amp;

</code></pre>
<h2>Post-Upgrade Validation</h2>
<h3>1. Verify Version</h3>
<pre class="bash"><code>
kubectl version --short

az aks show -g rg-aks-prod -n aks-prod --query kubernetesVersion

</code></pre>
<h3>2. Validate Node Pools</h3>
<pre class="bash"><code>
kubectl get nodes -o wide

az aks nodepool list -g rg-aks-prod --cluster-name aks-prod --output table

</code></pre>
<h3>3. Check Spot Node Functionality</h3>
<pre class="bash"><code>
# Verify spot nodes are labeled correctly

kubectl get nodes -l kubernetes.azure.com/scalesetpriority=spot



# Verify spot tolerating pods are scheduled correctly

kubectl get pods -A -o wide | grep spot

</code></pre>
<h3>4. Run Integration Tests</h3>
<pre class="bash"><code>
cd tests/

go test -v -timeout 10m -run TestAksSpotNodePoolAttributes

</code></pre>
<h2>Rollback Procedure</h2>
<blockquote>⚠️ <b>AKS does not support automatic rollback</b>. If issues occur:</blockquote>
<ol>
<li><b>Minor Issues:</b> Cordon affected nodes and wait for autoscaler to replace</li>
<li><b>Major Issues:</b> Create a new cluster from Terraform and migrate workloads</li>
</ol>
<h2>Recommended Timeline</h2>
<table>
<tr><td>Date</td><td>Action</td></tr>
<tr><td>Week 1</td><td>Test upgrade in dev environment</td></tr>
<tr><td>Week 2</td><td>Upgrade staging cluster</td></tr>
<tr><td>Week 3</td><td>Monitor staging for issues</td></tr>
<tr><td>Week 4</td><td>Upgrade production (maintenance window)</td></tr>
<h2>Support</h2>
<ul>
<li><b>AKS Upgrade Docs:</b> https://learn.microsoft.com/en-us/azure/aks/upgrade-cluster</li>
<li><b>K8s 1.29 Changelog:</b> https://kubernetes.io/blog/2023/12/13/kubernetes-v1-29-release/</li>
<li><b>Internal Contact:</b> Platform Engineering Team (#platform-engineering)</li>
</ul>
<p>---</p>
<p><b>Last Updated:</b> 2026-01-27  </p>
<p><b>Owner:</b> Platform Engineering Team</p>
</body></html>