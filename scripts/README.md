# AKS DevOps Toolkit

A comprehensive suite of **21 scripts** for DevOps Architects to audit, inspect, and manage Azure Kubernetes Service (AKS) fleets and related resources.

## ğŸš€ Quick Start

```bash
# 1. Install dependencies
pip install -r requirements.txt

# 2. Login to Azure
az login

# 3. Run the interactive toolkit
python devops_toolkit.py
```

The interactive menu will guide you through all available reports:

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   AKS DevOps Toolkit                                     â•‘
â•‘   Comprehensive Azure Kubernetes Audit Suite             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“Š Discovery
  [ 1] Discovery                  - Scan all subscriptions and generate inventory CSVs

ğŸ’° Cost & Optimization
  [ 3] Cost Audit                 - Analyze node pools for cost optimization
  [ 4] Orphaned Disks             - Find unattached managed disks wasting money
  [20] Spot VM Pricing            - Query Spot VM availability and pricing

ğŸ”’ Security & Compliance
  [ 5] Security Audit             - RBAC, identity, and policy compliance checks
  ...

Enter your choice:
>
```

---

## ğŸ“‹ Recommended Workflow

### Step 1: Discovery
Run the discovery script to scan all your subscriptions and generate inventory CSVs:

```bash
python discover.py --output ./inventory/
```

This creates:
- `inventory/clusters.csv` - All AKS clusters
- `inventory/acrs.csv` - All Azure Container Registries

### Step 2: Filter (Optional)
Open the CSV files in Excel or your preferred tool. Filter to the resources you want to audit. Save the filtered CSV.

### Step 3: Run Audits
Use the filtered CSV as input to specific audits:

```bash
python aks_cost_auditor.py --config samples/config.json
```

Or run everything interactively:
```bash
python devops_toolkit.py
```

---

## ğŸ“ Directory Structure

```
scripts/
â”œâ”€â”€ devops_toolkit.py      # Master controller (interactive menu)
â”œâ”€â”€ discover.py            # Discovery script (generates CSVs)
â”œâ”€â”€ spot_vm_pricing.py     # Spot VM availability & pricing
â”œâ”€â”€ utils.py               # Shared utilities & error handling
â”œâ”€â”€ requirements.txt       # Python dependencies
â”‚
â”œâ”€â”€ samples/               # Sample input files
â”‚   â”œâ”€â”€ clusters.csv       # Example cluster inventory
â”‚   â”œâ”€â”€ acrs.csv           # Example ACR inventory
â”‚   â””â”€â”€ config.json        # Example JSON config
â”‚
â””â”€â”€ [audit scripts]        # Individual audit scripts
```

---

## ğŸ“Š Available Reports

### Discovery & Inventory
| Script | Description |
|--------|-------------|
| `discover.py` | Scan all subscriptions, output CSV inventory |
| `aks_fleet_overview.py` | High-level cluster inventory |
| `aks_addon_inventory.py` | Add-on feature matrix |
| `acr_inventory.py` | ACR metadata and settings |

### Cost & Optimization
| Script | Description |
|--------|-------------|
| `aks_cost_auditor.py` | Node pool Spot/sizing analysis |
| `aks_disk_auditor.py` | Find orphaned Managed Disks |
| `aks_node_utilization.py` | CPU/Memory from Azure Monitor |
| `spot_vm_pricing.py` | Query Spot VM pricing & availability |

### Security & Compliance
| Script | Description |
|--------|-------------|
| `aks_auth_rbac.py` | AAD integration, RBAC audit |
| `aks_identity_audit.py` | Managed Identity vs Service Principal |
| `aks_policy_compliance.py` | Azure Policy compliance state |
| `aks_security_inspector.sh` | Quick Bash-based checks |

### Networking
| Script | Description |
|--------|-------------|
| `aks_network_audit.py` | VNet/Subnet/IP usage |
| `aks_ingress_audit.py` | AGIC and WAF status |

### Lifecycle & Upgrades
| Script | Description |
|--------|-------------|
| `aks_upgrade_planner.py` | Version upgrade paths |

### Observability
| Script | Description |
|--------|-------------|
| `aks_monitor_insights.py` | KQL queries against Log Analytics |

### Disaster Recovery & Secrets
| Script | Description |
|--------|-------------|
| `aks_backup_audit.py` | Azure Backup for AKS extension |
| `aks_keyvault_integration.py` | Key Vault CSI driver status |

### Container Registry
| Script | Description |
|--------|-------------|
| `acr_content_explorer.py` | List repos and image tags |
| `acr_vulnerability_report.py` | Defender for Containers findings |
| `acr_replication_audit.py` | Geo-replication status |

---

## ğŸ“¥ Input Formats

### CSV Format (Recommended)
Generated by `discover.py`:
```csv
subscription_id,resource_group,cluster_name,location,kubernetes_version
abc-123,rg-dev,dev-cluster,eastus,1.28.5
def-456,rg-prod,prod-cluster,westus2,1.27.9
```

### JSON Format (Legacy)
For backward compatibility:
```json
{
  "targets": [
    {
      "subscription_id": "abc-123",
      "resource_groups": ["rg-dev"],
      "clusters": ["dev-cluster"]
    }
  ]
}
```

---

## âš ï¸ Error Handling

All scripts include standardized error handling:
- **Permission Denied (403)**: Missing RBAC role
- **Unauthorized (401)**: Credentials expired - run `az login`
- **Not Found (404)**: Resource doesn't exist
- **Throttled (429)**: Too many requests

---

## ğŸ¤– Maintenance

See [AI_MAINTENANCE.md](AI_MAINTENANCE.md) for instructions on adding new scripts.
