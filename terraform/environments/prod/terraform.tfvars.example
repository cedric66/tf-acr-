###############################################################################
# Example Terraform Variables
# Copy this file to terraform.tfvars and update values for your environment
###############################################################################

###############################################################################
# Required Variables
###############################################################################

# Azure subscription ID
subscription_id = "00000000-0000-0000-0000-000000000000"

# Existing resource group for AKS deployment
resource_group_name = "rg-aks-prod"

# Existing virtual network configuration
vnet_name                = "vnet-aks"
vnet_resource_group_name = "rg-network" # Set to null or remove if same as resource_group_name
subnet_name              = "snet-aks"

###############################################################################
# Optional: Environment Configuration
###############################################################################

environment         = "prod"
location            = "australiaeast"
kubernetes_version  = "1.34"
cluster_name_prefix = "aks-spot"
os_sku              = "Ubuntu"

# Enable host-based encryption (requires EncryptionAtHost feature)
host_encryption_enabled = false

# Log Analytics retention period (days)
log_analytics_retention_days = 30

###############################################################################
# Node Pool Configurations - RESILIENCE STRATEGY
# 
# IMPORTANT: Each spot pool uses ONE ZONE + ONE SKU FAMILY
# This ensures if one SKU/Zone fails, others can still spin up nodes
###############################################################################

# System node pool (required for cluster)
system_pool_config = {
  name                = "system"
  vm_size             = "Standard_D4s_v5"
  min_count           = 2
  max_count           = 3
  zones               = ["1", "2", "3"]
  os_disk_size_gb     = 128
  enable_auto_scaling = true
}

# Standard (on-demand) node pools - FALLBACK for spot failures
standard_pool_configs = [
  {
    name                = "stdfallback"
    vm_size             = "Standard_D4s_v5"
    min_count           = 1
    max_count           = 2
    zones               = ["1", "2", "3"]
    os_disk_size_gb     = 128
    enable_auto_scaling = true
    labels = {
      "workload-tier" = "production"
      "priority"      = "on-demand"
    }
  }
]

# Spot node pools - DIVERSIFIED STRATEGY
# Each pool: 1 zone + 1 SKU family = maximum resilience
spot_pool_configs = [
  # Zone 1: D-series (general purpose, 4 vCPU)
  {
    name            = "spotd4z1"
    vm_size         = "Standard_D4s_v5"
    min_count       = 0
    max_count       = 3
    zones           = ["1"]
    spot_max_price  = -1
    eviction_policy = "Delete"
    priority_weight = 10
    labels = {
      "spot-pool-id" = "1"
      "vm-family"    = "d-series"
      "zone"         = "1"
    }
  },
  # Zone 2: D-series (general purpose, 8 vCPU)
  {
    name            = "spotd8z2"
    vm_size         = "Standard_D8s_v5"
    min_count       = 0
    max_count       = 3
    zones           = ["2"]
    spot_max_price  = -1
    eviction_policy = "Delete"
    priority_weight = 10
    labels = {
      "spot-pool-id" = "2"
      "vm-family"    = "d-series"
      "zone"         = "2"
    }
  },
  # Zone 3: E-series (memory optimized)
  {
    name            = "spote4z3"
    vm_size         = "Standard_E4s_v5"
    min_count       = 0
    max_count       = 3
    zones           = ["3"]
    spot_max_price  = -1
    eviction_policy = "Delete"
    priority_weight = 10
    labels = {
      "spot-pool-id" = "3"
      "vm-family"    = "e-series"
      "zone"         = "3"
    }
  },
  # Zone 1: F-series (compute optimized) - DIFFERENT FAMILY, SAME ZONE
  # Provides fallback if D-series exhausted in zone 1
  {
    name            = "spotf8z1"
    vm_size         = "Standard_F8s_v2"
    min_count       = 0
    max_count       = 3
    zones           = ["1"]
    spot_max_price  = -1
    eviction_policy = "Delete"
    priority_weight = 5 # Lower priority = backup option
    labels = {
      "spot-pool-id" = "4"
      "vm-family"    = "f-series"
      "zone"         = "1"
    }
  }
]

###############################################################################
# Optional: AAD & RBAC
###############################################################################

# Azure AD group object IDs for cluster admin access (optional)
# admin_group_object_ids = ["00000000-0000-0000-0000-000000000000"]

###############################################################################
# Optional: Tags
###############################################################################

tags = {
  environment = "prod"
  location    = "australiaeast"
  managed_by  = "terraform"
  project     = "aks-spot-optimization"
  cost_center = "platform"
  owner       = "devops-team"
}
